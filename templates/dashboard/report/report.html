{% extends 'partials/base.html' %}
{% block title %} Báo Cáo Tồn Kho {% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow-sm">
                <div class="card-header bg-primary text-white">
                    <h4><i class="fas fa-chart-pie"></i> Báo Cáo & Thống Kê</h4>
                </div>
            </div>
        </div>
    </div>

    <!-- Hàng chứa các biểu đồ -->
    <div class="row">
        <!-- Biểu đồ 1: Tồn kho sản phẩm -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <canvas id="productQuantityChart"></canvas>
                </div>
            </div>
        </div>

        <!-- Biểu đồ 2: Tỉ lệ xuất kho -->
        <div class="col-lg-6 mb-4">
            <div class="card shadow-sm">
                <div class="card-body">
                    <canvas id="orderDistributionChart"></canvas>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // === BIỂU ĐỒ 1: SỐ LƯỢNG TỒN KHO ===
    var ctx1 = document.getElementById('productQuantityChart').getContext('2d');
    var productQuantityChart = new Chart(ctx1, {
        type: 'bar',
        data: {
            labels: [{% for product in products %}'{{ product.name|escapejs }}'{% if not forloop.last %},{% endif %}{% endfor %}],
            datasets: [{
                label: 'Số Lượng Tồn Kho',
                data: [{% for product in products %}{{ product.quantity|default:0 }}{% if not forloop.last %},{% endif %}{% endfor %}],
                backgroundColor: '#005f73',
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Số Lượng Thuốc Hiện Có Trong Kho',
                    font: { size: 16 }
                }
            },
            scales: { y: { beginAtZero: true } }
        }
    });

    // === BIỂU ĐỒ 2: PHÂN BỐ ĐƠN HÀNG ĐÃ XUẤT ===
    var ctx2 = document.getElementById('orderDistributionChart').getContext('2d');
    var orderDistributionChart = new Chart(ctx2, {
        type: 'pie',
        data: {
            labels: [{% for order in orders %}'{{ order.product.name|escapejs }}'{% if not forloop.last %},{% endif %}{% endfor %}],
            datasets: [{
                label: 'Số lượng đã xuất',
                data: [{% for order in orders %}{{ order.order_quantity|default:0 }}{% if not forloop.last %},{% endif %}{% endfor %}],
                backgroundColor: ['#DE51A8', '#0a9396', '#ee9b00', '#94d2bd', '#005f73', '#e9d8a6', '#ca6702'],
                borderColor: '#ffffff',
                borderWidth: 2
            }]
        },
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: 'Tỉ Lệ Các Loại Thuốc Đã Được Cấp Phát',
                    font: { size: 16 }
                }
            }
        }
    });
});
</script>
{% endblock %}